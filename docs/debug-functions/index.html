<!DOCTYPE html>
<html>
<!-- Head information -->
<head>
<meta charset='utf-8'>
<meta content='width=device-width' initial-scale='1' name='viewport'>
<!-- Always force latest IE rendering engine or request Chrome Frame -->
<!-- %meta{content: 'IE=edge,chrome=1', http-equiv: 'X-UA-Compatible'} -->
<link href='/assets/images/favicon/favicon-196x196.png' rel='icon' sizes='196x196' type='image/png'>
<link href='/assets/images/favicon/favicon-32x32.png' rel='icon' sizes='32x32' type='image/png'>
<link href='/assets/images/favicon/favicon-16x16.png' rel='icon' sizes='16x16' type='image/png'>
<link href='/assets/images/favicon/favicon-128.png' rel='icon' sizes='128x128' type='image/png'>
<link href='/assets/images/favicon/favicon.ico' rel='icon'>
<!-- Use title if it's in the page YAML frontmatter -->
<title>
Kubeless
</title>
<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css' media='screen' rel='stylesheet'>
<!-- Bitnami Design System -->
<link href='https://fonts.googleapis.com/css?family=Fira+Sans:300,400,700|Hind:300,400' media='screen' rel='stylesheet'>
<link href='//d1d5nb8vlsbujg.cloudfront.net/bitnami-ui/2.0.1/bitnami.ui.components.min.css' media='screen' rel='stylesheet'>
<link href='//d1d5nb8vlsbujg.cloudfront.net/bitnami-ui/2.0.1/bitnami.ui.min.css' media='screen' rel='stylesheet'>
<!-- Include the javascripts and the styles of the page -->
<link href="/assets/stylesheets/main.css" rel="stylesheet" />
<script src="/assets/javascripts/main.js"></script>
</head>

<!-- Main content -->
<body>
<div class='gradient-135-accent elevation-1'>
<div class='container'>
<header class='Header padding-v-big'>
<div class='row collapse-b-tablet align-center'>
<div class='col-4'>
<div class='Header__Logo'>
<a href="/"><img src="/assets/images/logo-white.svg" alt="Logo white" />
<span>
A Bitnami project
</span>
</a></div>
</div>
<div class='col-8'>
<nav class='text-r'>
<a href="/" class="margin-h-normal">Home</a>
<a href="/docs" class="margin-h-normal">Documentation</a>
<a href="https://github.com/kubeless/kubeless-ui" class="margin-h-normal">Kubeless UI</a>
<a href="https://serverless.com/framework/docs/providers/kubeless/guide/intro/" class="margin-h-normal">Serverless Plugin</a>
<a href="https://github.com/kubeless" class="margin-l-normal">GitHub</a>
</nav>
</div>
</div>
</header>

</div>
</div>
<main class='container margin-t-big'>
<div class='row collapse-b-phone-land'>
<div class='col-3'>
<h4 class='margin-t-bigger'>
<img src="/assets/images/logo-dark.svg" alt="Kubeless logo" class="float-l avatar avatar-medium" />
<div class='padding-v-small'>
Documentation
</div>
</h4>
<ul class='remove-style padding-small'>
<li>
<b>Usage</b>
</li>
<li class='margin-v-small'>
<a href="/docs/quick-start">Quick Start
</a></li>
<li class='margin-v-small'>
<a href="/docs/runtimes">Runtimes
</a></li>
<li class='margin-v-small'>
<a href="/docs/kubeless-functions">Function Characteristics
</a></li>
<li class='margin-v-small'>
<a href="/docs/triggers">Triggers
</a></li>
<li class='margin-v-small'>
<a href="/docs/pubsub-functions">PubSub Mechanism
</a></li>
<li class='margin-v-small'>
<a href="/docs/http-triggers">Expose and Secure Functions
</a></li>
<li class='margin-v-small'>
<a href="/docs/cronjob-triggers">Scheduling a function execution (CronJob)
</a></li>
<li class='margin-v-small'>
<a href="/docs/streaming-functions">Data Stream Events
</a></li>
<li class='margin-v-small'>
<a href="/docs/debug-functions">Debug Functions
</a></li>
<li class='margin-v-small'>
<a href="/docs/autoscaling">Autoscaling
</a></li>
<li class='margin-v-small'>
<a href="/docs/building-functions">Build Function Images
</a></li>
<li class='margin-v-small'>
<a href="/docs/monitoring">Monitoring
</a></li>
<li class='margin-v-small'>
<a href="/docs/advanced-function-deployment">Advanced deployment
</a></li>
<li class='margin-v-small'>
<a href="/docs/function-controller-configuration">Kubeless Configuration
</a></li>
<li class='margin-v-small'>
<a href="/docs/use-existing-kafka">Use a Custom Apache Kafka
</a></li>
<li class='margin-v-small'>
<a href="/docs/troubleshooting">Install Troubleshooting
</a></li>
<li class='padding-t-big'>
<b>Cloud Providers</b>
</li>
<li class='margin-v-small'>
<a href="/docs/kubeless-on-AKS">Azure Kubernetes Service
</a></li>
<li class='margin-v-small'>
<a href="/docs/GKE-deployment">Google Kubernetes Engine
</a></li>
<li class='padding-t-big'>
<b>Development</b>
</li>
<li class='margin-v-small'>
<a href="/docs/architecture">Architecture
</a></li>
<li class='margin-v-small'>
<a href="/docs/dev-guide">Development Guide
</a></li>
<li class='margin-v-small'>
<a href="/docs/implementing-new-runtime">Implementing a New Runtime
</a></li>
<li class='margin-v-small'>
<a href="/docs/implementing-new-trigger">Implementing a New Trigger
</a></li>
<li class='margin-v-small'>
<a href="/docs/debugging">Debugging
</a></li>
<li class='margin-v-small'>
<a href="/docs/release-flow">Release Flow
</a></li>
</ul>

</div>
<div class='col-9'>
<h1 id="debug-kubeless-functions">Debug Kubeless Functions</h1>

<p>In this document we will show how you can debug your function in order to spot possible errors. There could be several reasons that causes a wrong deployment. For learning how to successfully debug a function it is important to know what is the process of deploying a Kubeless function. In this guide we are going to assume that you are using the <code>kubeless</code> CLI tool to deploy your functions. If that is the case, this is the process to run a function:</p>

<ol>
<li>The <code>kubeless</code> CLI read the parameters you give to it and produces a <a href="/docs/advanced-function-deployment">Function</a> object that submits to the Kubernetes API server.</li>
<li>The Kubeless Function Controller detects that a new <code>Function</code> has been created and reads its content. From the function content it generates: a <code>ConfigMap</code> with the function code and its dependencies, a <code>Service</code> to make the function reachable through HTTP and a <code>Deployment</code> with the base image and all the required steps to install and run your functions. It is important to know this order because if the controller fails to deploy the <code>ConfigMap</code> or the <code>Service</code> it will never create the <code>Deployment</code>. A failure in any step will abort the process.</li>
<li>Once the <code>Deployment</code> has been created a <code>Pod</code> should be generated with your function. When a Pod starts it dinamically reads the content of your function (in case of interpreted languages).</li>
</ol>

<p>After all the above you are ready to call your function. Let&#39;s see some common mistakes and how to fix them.</p>

<h2 id="kubeless-function-deploy-fails">&quot;kubeless function deploy&quot; fails</h2>

<p>The first failure that can appear is an error in the parameters that we give to the <code>kubeless function deploy</code> command. Hopefully this errors are pretty easy to debug:</p>

<pre><code class="console">$ kubeless function deploy --runtime node8 \
  --from-file hello.js \
  --handler todos.create \
  --dependencies package.json \
  hello
FATA[0000] Invalid runtime: node8. Supported runtimes are: python2.7, python3.4, python3.6, nodejs6, nodejs8, ruby2.4, php7.2, go1.10
</code></pre>

<p>In the above we can see that we have a typo in the runtime. It should be <code>nodejs8</code> instead of <code>node8</code>.</p>

<h2 id="kubeless-function-ls-returns-missing-check-controller-logs">&quot;kubeless function ls&quot; returns &quot;MISSING: Check controller logs&quot;</h2>

<p>There will be cases in which the validations done in the CLI won&#39;t be enough to spot a problem in the given parameters. If that is the case the function <code>Deployment</code> will never appear. To debug this kind of issues it is necessary to check what is the error in the controller logs. To retrieve these logs execute:</p>

<pre><code>$ kubeless function deploy foo --from-file hellowithdata.py --handler hello,foo --runtime python3.6
INFO[0000] Deploying function...
INFO[0000] Function foo submitted for deployment
INFO[0000] Check the deployment status executing &#39;kubeless function ls foo&#39;
$ kubeless function ls
NAME    NAMESPACE   HANDLER     RUNTIME     DEPENDENCIES    STATUS
foo     default     hello,foo   python3.6                   MISSING: Check controller logs
$ kubectl logs -n kubeless -l kubeless=controller
time=&quot;2018-04-27T15:12:28Z&quot; level=info msg=&quot;Processing update to function object foo Namespace: default&quot; controller=cronjob-trigger-controller
time=&quot;2018-04-27T15:12:28Z&quot; level=error msg=&quot;Function can not be created/updated: failed: incorrect handler format. It should be module_name.handler_name&quot; pkg=function-controller
time=&quot;2018-04-27T15:12:28Z&quot; level=error msg=&quot;Error processing default/foo (will retry): failed: incorrect handler format. It should be module_name.handler_name&quot; pkg=function-controller
</code></pre>

<p>From the logs we can see that there is a problem with the handler: we specified <code>hello,foo</code> while the correct value is <code>hello.foo</code>.</p>

<h2 id="function-pod-is-crashing">Function pod is crashing</h2>

<p>The most common error is finding that the <code>Deployment</code> is generated successfully but the function remains with the status <code>0/1 Not ready</code>. This is usually caused by a syntax error in our function or in the dependencies we specify.</p>

<p>If our function doesn&#39;t start we should check the status of the pods executing:</p>

<pre><code>$ kubectl get pods -l function=foo
</code></pre>

<h3 id="function-pod-crashes-with-init-crashloopbackoff">Function pod crashes with Init:CrashLoopBackOff</h3>

<p>If our function fails with an <code>Init</code> error that could mean that:</p>

<ul>
<li>It fails to retrieve the function content.</li>
<li>It fails to install dependencies.</li>
<li>It fails to compile our function (in compiled languages).</li>
</ul>

<p>For any of the above we should first identify which container is failing (since each step is performed in a different container):</p>

<pre><code class="console">$ kubectl get pods -l function=foo
NAME                   READY     STATUS                  RESTARTS   AGE
foo-74978bbf45-9xb4p   0/1       Init:CrashLoopBackOff   1         6m
$ kubectl get pods -l function=foo -o yaml
...
      name: install
      ready: false
      restartCount: 2
...
</code></pre>

<p>From the above we can see that is the container <code>install</code> is the one with the problem. Depending on the runtime the logs of the container will be shown as well so we can directly spot the issue. Unfortunately that is not the case so let&#39;s retrieve manually the logs of the <code>install</code> container:</p>

<pre><code class="console">$ kubectl logs foo-74978bbf45-9xb4p -c install --previous
...
Collecting twiter (from -r /kubeless/requirements.txt (line 1))
  Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;NewConnectionError(&#39;&lt;pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x7f10eb4d7400&gt;: Failed to establish a new connection: [Errno -3] Temporary failure in name resolution&#39;,)&#39;: /simple/twiter/
</code></pre>

<p>Now we can spot that the problem is a typo in our requirements: <code>twiter</code> should be <code>twitter</code>.</p>

<h3 id="function-pod-crashes-with-crashloopbackoff">Function pod crashes with CrashLoopBackOff</h3>

<p>In the case the Pod remains in that state we should retrieve the logs of the runtime container:</p>

<pre><code class="console">$ kubectl get pods -l function=bar
NAME                   READY     STATUS             RESTARTS   AGE
bar-7d458f6d7c-2gsh7   0/1       CrashLoopBackOff   7          15m
$ kubectl logs -l function=bar
kubectl logs -l function=bar
Traceback (most recent call last):
...
  File &quot;/kubeless/hello.py&quot;, line 2
    return Hello world
                     ^
SyntaxError: invalid syntax
</code></pre>

<p>We can see that we have a syntax error: <code>return Hello world</code> should be modified with <code>return &quot;Hello world&quot;</code>.</p>

<h3 id="function-returns-an-internal-server-error">Function returns an &quot;Internal Server Error&quot;</h3>

<p>There will be cases in which the pod doesn&#39;t crash but the function returns an error:</p>

<pre><code class="console">$ kubectl get pods -l function=test
NAME                    READY     STATUS    RESTARTS   AGE
test-6845ff45cb-6q865   1/1       Running   0          1m
$ kubeless function call test --data &#39;{&quot;username&quot;: &quot;test&quot;}&#39;
ERRO[0000]
FATA[0000] an error on the server (&quot;Internal Server Error&quot;) has prevented the request from succeeding
</code></pre>

<p>This usually means that the function is syntactically correct but it has a bug. Again for spotting the issue we should check the function logs:</p>

<pre><code class="console">$ kubectl logs -l function=test
...
[27/Apr/2018:15:45:33 +0000] &quot;GET /healthz HTTP/1.1&quot; 200 2 &quot;-&quot; &quot;kube-probe/.&quot;
Function failed to execute: TypeError: Cannot read property &#39;name&#39; of undefined
    at handler (/kubeless/hello.js:3:39)
    ...
</code></pre>

<p>We can see that it is raising an error in the line 3 of our function:</p>

<pre><code class="js">module.exports = {
  handler: (event, context) =&gt; {
    return &quot;Hello &quot; + event.data.user.name;
  },
};
</code></pre>

<p>We are trying to access the property <code>name</code> of the property <code>user</code> while we are giving the function <code>username</code> instead.</p>

<h2 id="conclusion">Conclusion</h2>

<p>These are just some tips to quickly identify what&#39;s gone wrong with a function. If after checking the controller and function logs (or any other information that Kubernetes may provide) you are not able to spot the error you can open an <a href="https://github.com/kubeless/kubeless/issues">Issue in our GitHub repository</a> or contact us through <a href="http://slack.k8s.io">slack</a> in the #kubeless channel.</p>

</div>
</div>
</main>
<div class='margin-t-giant'>
<div class='Footer'>
<div class='container padding-h-big padding-v-bigger'>
<div class='Footer__Border padding-t-big'>
<div class='row collapse-b-phone-land'>
<div class='col-6'>
<h4 class='inverse margin-reset'>
<img src="/assets/images/logo-white.svg" alt="Kubeless logo" class="Footer__Logo" />
</h4>
<p class='type-color-iron type-small margin-reset'>
Â© Kubeless 2021 | All Rights Reserved.
</p>
</div>
<div class='col-6 text-r'>
<a href="https://github.com/kubeless" class="margin-l-small"><img src="/assets/images/social/github.svg" alt="See the Github Profile of the Kubeless project" />
</a></div>
</div>
</div>
</div>
</div>

</div>
</body>
</html>
<script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
